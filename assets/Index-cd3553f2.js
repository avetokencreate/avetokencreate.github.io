import{D as G}from"./Dialog-0ec7f86b.js";import{e as j,m as z,d as J,g as w,E as X,r as x,o as B,h as q,j as C,w as I,u as Q,s as n,G as E,H as b,I as W,b as p,t as F,a as $,z as Y}from"./index-69bf0c45.js";import{E as R,M as Z,S as M}from"./Swap-ad87e949.js";import{u as ee}from"./create-672ee266.js";import{_ as ae}from"./SvgIcon-b7a16c96.js";import{B as l}from"./bignumber-3e8dfdf6.js";import{f as U,p as f}from"./units-1c3e5529.js";/* empty css                                                       */const te={class:"van-dialog__header"},se={class:"van-dialog__content"},oe={class:"van-dialog__message van-dialog__message--has-title"},ne={style:{paddingTop:"20px"}},le={class:"create-success-title"},re={class:"create-success-text"},ie={class:"create-success-text"},Fe={__name:"Index",setup(ue){const{t:o}=j(),O=z(),d=J(),e=ee(),A=w(!1),T=w(!1),S=w(!1),N=w(!1),_=w(!1),L=w(!1),g=w(""),k=w("");async function D(){N.value=!0;try{const u=await new E(window.ethereum).getSigner();let i=await new b(d.tokenFactoryAddress,W,u).baseFeeToken();console.log("baseFeeTokenAddress",i),(await(await new b(i,R,u).approve(d.tokenFactoryAddress,Z)).wait()).status===1&&(n({type:"success",message:o("upChainSuccessfully")}),S.value=!1)}catch(t){console.log(t),t.info&&t.info.error&&t.info.error.code===4001?n(o("userCancelOperate")):t.error&&t.error.message&&t.error.message=="Canceled"?n(o("userCancelOperate")):n(o("unkonwError"))}finally{N.value=!1}}async function H(){console.log("createTokenClick");const t=/^0x[0-9a-fA-F]{40}(,\d*\.?\d+)?$/;if(d.chainId==-1){d.netErrorDialogShow=!0;return}if(e.deployerId===0||e.deployerId===1||e.deployerId===2){if(!e.name){n(o("pleaseEnterName"));return}if(!e.symbol){n(o("pleaseEnterSymbol"));return}if(!e.totalSupply){n(o("pleaseEnterTotal"));return}}if(e.deployerId===1||e.deployerId==2){if(!e.token){n(o("pleaseSelectCurrency"));return}if(!e.chainSwap){n(o("pleaseSelectSwap"));return}if(e.deployerId===1){if(l(e.buyFundFee).plus(e.buyBurnFee).plus(e.buyLPFee).plus(e.sellFundFee).plus(e.sellBurnFee).plus(e.sellLPFee).lte(0)){n(o("taxMustGt0"));return}}else if(e.deployerId===2){if(l(e.buyFundFee).plus(e.buyLPFee).plus(e.sellFundFee).plus(e.sellLPFee).lte(0)){n(o("taxlimit2"));return}}else if(e.deployerId===3){if(!e.rewardToken){n(o("dividendTokenError"));return}if(!t.test(e.rewardToken)){n(o("pleaseEnterTrueAddress"));return}if(l(e.buyFundFee).plus(e.buyLPFee).plus(e.buyRewardFee).plus(e.sellFundFee).plus(e.sellLPFee).plus(e.sellRewardFee).lte(0)){n(o("taxMustGt0"));return}}if((Number(e.buyFundFee)>0||Number(e.sellFundFee)>0)&&!e.fundAddress){n(o("pleaseEnterMarketingAddress"));return}if(e.fundAddress&&!t.test(e.fundAddress)){n(o("pleaseEnterTrueAddress"));return}if(e.enableKillBlock&&(!e.killBlock||Number(e.killBlock)<=0)){n(o("pleaseEnterKillBlockNumber"));return}if(e.enableWalletLimit&&(!e.maxWalletAmount||Number(e.maxWalletAmount)<=0)){n(o("pleaseEnterMaxWalletLimit"));return}if(e.enableSwapLimit&&(!e.maxSwapAmount||Number(e.maxSwapAmount)<=0)){n(o("pleaseEnterMaxSwapLimit"));return}}_.value=!0;const y=await new E(window.ethereum).getSigner(),i=new b(d.tokenFactoryAddress,W,y);let r=await i.baseFee();console.log("baseFee",r);let a=await i.baseFeeToken();console.log("baseFeeTokenAddress",a);const s=new b(a,R,y),h=await s.decimals();if(a.toLowerCase()==="0x9ebab27608bd64aff36f027049aecc69102a0d1e")k.value="USDT-lfgbridge";else{let v=await s.symbol();k.value=v.toUpperCase()}g.value=U(r,h);const c=await s.balanceOf(d.walletAddress);if(console.log("baseFeeTokenBalance",c),c<r){n(o("balanceSlow2",{chainMianCoin:k.value,amount:g.value})),_.value=!1;return}const m=await s.allowance(d.walletAddress,d.tokenFactoryAddress);console.log("allowance",m),m<r?S.value=!0:S.value=!1,A.value=!0,_.value=!1}async function K(){L.value=!0;try{const u=await new E(window.ethereum).getSigner(),y=new b(d.tokenFactoryAddress,W,u),i=[],r=[],a=[],s=[];if(e.deployerId==0)i[0]=e.name,i[1]=e.symbol,a[0]=e.decimals,a[1]=f(e.totalSupply,e.decimals),s[0]=e.canMint;else if(e.deployerId==1){i[0]=e.name,i[1]=e.symbol;let c=e.token.tokenAddress,m=!1;c==="0xeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeee"&&(c=(await new b(e.chainSwap.routerAddress,M,u).WETH()).toLowerCase(),m=!0),r[0]=c,r[1]=e.chainSwap.routerAddress,r[2]=d.walletAddress,r[3]=e.fundAddress?e.fundAddress:"0x0000000000000000000000000000000000000000",a[0]=e.decimals,a[1]=f(e.totalSupply,e.decimals),a[2]=l(e.buyFundFee).times(100).toNumber(),a[3]=l(e.buyBurnFee).times(100).toNumber(),a[4]=l(e.buyLPFee).times(100).toNumber(),a[5]=l(e.sellFundFee).times(100).toNumber(),a[6]=l(e.sellBurnFee).times(100).toNumber(),a[7]=l(e.sellLPFee).times(100).toNumber(),a[8]=e.killBlock?l(e.killBlock).toNumber():0,a[9]=e.maxSwapAmount?f(e.maxSwapAmount,e.decimals):0n,a[10]=e.maxWalletAmount?f(e.maxWalletAmount,e.decimals):0n,s[0]=e.canMint,s[1]=m,s[2]=e.enableManualStartTrade,s[3]=e.enableKillBlock,s[4]=e.enableSwapLimit,s[5]=e.enableWalletLimit,s[6]=e.enableChangeTax,s[7]=e.enableWhiteList}else if(e.deployerId==2){i[0]=e.name,i[1]=e.symbol;let c=e.token.tokenAddress,m=!1;c==="0xeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeee"&&(c=(await new b(e.chainSwap.routerAddress,M,u).WETH()).toLowerCase(),m=!0),r[0]=c,r[1]=e.chainSwap.routerAddress,r[2]=d.walletAddress,r[3]=e.fundAddress?e.fundAddress:"0x0000000000000000000000000000000000000000",a[0]=e.decimals,a[1]=f(e.totalSupply,e.decimals),a[2]=l(e.buyFundFee).times(100).toNumber(),a[3]=l(e.buyRewardFee).times(100).toNumber(),a[4]=l(e.buyLPFee).times(100).toNumber(),a[5]=l(e.sellFundFee).times(100).toNumber(),a[6]=l(e.sellRewardFee).times(100).toNumber(),a[7]=l(e.sellLPFee).times(100).toNumber(),a[8]=e.killBlock?l(e.killBlock).toNumber():0,a[9]=e.maxSwapAmount?f(e.maxSwapAmount,e.decimals):0n,a[10]=e.maxWalletAmount?f(e.maxWalletAmount,e.decimals):0n,s[0]=m,s[1]=e.enableManualStartTrade,s[2]=e.enableKillBlock,s[3]=e.enableSwapLimit,s[4]=e.enableWalletLimit,s[5]=e.enableChangeTax,s[6]=e.enableWhiteList}else if(e.deployerId==3){i[0]=e.name,i[1]=e.symbol;let c=e.token.tokenAddress,m=!1;c==="0xeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeee"&&(c=(await new b(e.chainSwap.routerAddress,M,u).WETH()).toLowerCase(),m=!0),r[0]=c,r[1]=e.chainSwap.routerAddress,r[2]=d.walletAddress,r[3]=e.fundAddress?e.fundAddress:"0x0000000000000000000000000000000000000000",r[4]=e.rewardToken,a[0]=e.decimals,a[1]=f(e.totalSupply,e.decimals),a[2]=l(e.buyFundFee).times(100).toNumber(),a[3]=l(e.buyRewardFee).times(100).toNumber(),a[4]=l(e.buyLPFee).times(100).toNumber(),a[5]=l(e.sellFundFee).times(100).toNumber(),a[6]=l(e.sellRewardFee).times(100).toNumber(),a[7]=l(e.sellLPFee).times(100).toNumber(),a[8]=e.killBlock?l(e.killBlock).toNumber():0,a[9]=e.maxSwapAmount?f(e.maxSwapAmount,e.decimals):0n,a[10]=e.maxWalletAmount?f(e.maxWalletAmount,e.decimals):0n,s[0]=m,s[1]=e.enableManualStartTrade,s[2]=e.enableKillBlock,s[3]=e.enableSwapLimit,s[4]=e.enableWalletLimit,s[5]=e.enableChangeTax,s[6]=e.enableWhiteList,s[7]=e.canMint}console.log(e.deployerId,i,r,a,s);const h=await y.tokenCreate(e.deployerId,i,r,a,s);console.dir(h),e.txHash=h.hash,h.wait().then(async c=>{c.status===1&&n({type:"success",message:o("upChainSuccessfully")})}),T.value=!0}catch(t){if(console.log(JSON.stringify(t)),t.info&&t.info.error&&t.info.error.code===4001)n(o("userCancelOperate"));else if(t.error&&t.error.message&&t.error.message=="Canceled")n(o("userCancelOperate"));else if(t.data&&t.data.code==-32e3){const u=t.data.message.match(/(\d+) want (\d+)/)[2];n(o("balanceSlow2",{chainMianCoin:d.token.chainCoinSymbol,amount:U(u)}))}else t.code==="INSUFFICIENT_FUNDS"?n(o("balanceSlow")):t.info&&t.info.error&&t.info.error.code==-32603&&t.info.error.data.message.endsWith("transfer amount exceeds balance")?n(o("balanceSlow2",{chainMianCoin:k.value,amount:g.value})):t.code=="CALL_EXCEPTION"&&t.info.error.message.endsWith("transfer amount exceeds balance")?n(o("balanceSlow2",{chainMianCoin:k.value,amount:g.value})):n(o("unkonwError"))}finally{A.value=!1,L.value=!1}}function V(){window.open(d.txNetwork+e.txHash,"_blank")}return X(()=>{console.log("create before mounted")}),(t,u)=>{const y=x("router-view"),i=x("van-action-bar-button"),r=x("van-action-bar"),a=x("van-popup");return B(),q("div",null,[C(y,{onCreateTokenClick:H,createTokenLoading:_.value},null,8,["createTokenLoading"]),C(a,{show:A.value,"onUpdate:show":u[0]||(u[0]=s=>A.value=s),round:"",closeable:"",class:"van-dialog van-dialog--round-button","close-on-click-overlay":!1},{default:I(()=>[p("div",te,F(t.$t("tokenCreationSoon")),1),p("div",se,[p("div",oe,[p("div",null,F(t.$t("createConfirmInfo")),1),p("div",ne,F(t.$t("serviceFeeCreation",{baseFeeAmount:g.value,baseFeeSymbol:k.value})),1)])]),C(r,{class:"van-dialog__footer"},{default:I(()=>[S.value?(B(),$(i,{key:0,type:"danger",text:t.$t("approveFirst"),class:"van-dialog__confirm",loading:N.value,onClick:D},null,8,["text","loading"])):(B(),$(i,{key:1,type:"danger",loading:L.value,color:"#3F80F7",text:t.$t("confirmAndCreate"),class:"van-dialog__confirm",onClick:K},null,8,["loading","text"]))]),_:1})]),_:1},8,["show"]),C(G,{show:T.value,"onUpdate:show":u[1]||(u[1]=s=>T.value=s),theme:"round-button",showCancelButton:!1,confirmButtonText:t.$t("enterTokenManagement"),onOnConfirm:u[2]||(u[2]=s=>Q(O).push("/"))},{default:I(()=>[p("div",null,[C(ae,{name:"createSuccess",style:{width:"48px",height:"48px"}})]),p("div",le,F(t.$t("createdSubmitted")),1),p("div",re,[Y(F(t.$t("inBrowser")),1),p("span",{class:"show",onClick:V},F(t.$t("view")),1)]),p("div",ie,F(t.$t("waitToView")),1)]),_:1},8,["show","confirmButtonText"])])}}};export{Fe as default};
